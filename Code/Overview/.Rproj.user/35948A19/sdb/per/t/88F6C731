{
    "contents" : "require(ggplot2)\nrequire(dplyr)\nrequire(lubridate)\nrequire(tidyr)\nrequire('rgdal')\nrequire('maptools')\nrequire('mapproj')\nrequire('ggmap')\nrequire('extrafont')\nrequire('plyr')\nsource('cctheme.R')\ngpclibPermit()\n\n#AMI\noverview<-read.csv(\"NatAMI_Urban_Ed_Ins_NW_c.csv\")\nstringsAsFactor= FALSE\nstr(overview)\nhead(overview)\n\n#SMI\noverviewSMI<-read.csv(\"NatSMI_Urban_Ed_Ins_NW_c.csv\")\nstringsAsFactor= FALSE\nstr(overviewSMI)\nhead(overviewSMI)\n\n#AMI years\nyears<-read.csv(\"Nat_AMI_2008-14.csv\")\nstringsAsFactor= FALSE\nstr(overview)\nhead(years)\n\n#SMI years\nyearsSMI<-read.csv(\"Nat_SMI_2008-14c.csv\")\nstringsAsFactor= FALSE\nstr(overview)\nhead(yearsSMI)\n\noverviewtot<-select(overview, Char, Total)\nhead(overviewtot)\n\n#SUD overlaps with AMI and SUD\nSUDAMISMI<-read.csv(\"AMI_SMI_SUD_intheGeneralPopc.csv\")\nstringsAsFactor= FALSE\nstr(overview)\nhead(SUDAMISMI)\n\n#AMI to get rows for AMI adults below FPL\noverviewUSFPL1<-overview %>%\n  filter(Char== 'Less Than 100 FPL')\nhead(overviewUSFPL1)\n\n#AMI to get rows for total adults AMI \noverviewUSFPL<-overview %>%\n  filter(Char=='U.S.') \nhead(overviewUSFPL)\n\n#rbind AMI total and AMI below FPL\noverviewUSFPL2 <- rbind(overviewUSFPL1, overviewUSFPL)\nhead(overviewUSFPL2)\n\noverviewFPL<-gather(overviewUSFPL2, charact, percent, Total:Aged.50.)\nhead(overviewFPL)\n\n#SMI do the same as above\noverviewSMIFPL<-overviewSMI %>%\n  filter(Socioeconomic=='Less Than 100%')\nhead(overviewSMIFPL)\n\noverviewUSSMIFPL<-overviewSMI %>%\n  filter(Socioeconomic=='TOTAL') \nhead(overviewUSSMIFPL)\n\noverviewSMIFPL2 <- rbind(overviewSMIFPL, overviewUSSMIFPL)\nhead(overviewSMIFPL2)\n\noverviewSMIFPL3<-gather(overviewSMIFPL2, age, percent, Total:Aged.50.)\nhead(overviewSMIFPL3)\n\n#bar chart: AMI numbers by region, note have to cut this by population to get rate\nregion<-ggplot(overviewtot[2:5,], aes(reorder(x=Char, Total), y=Total))+\n  geom_bar(stat=\"identity\", width=.2, fill=\"green\")+\n    xlab(\"Region\")+\n    ylab(\"Percent\")+\n    scale_y_continuous(limits=c(0,20)) +\n  cctheme+\n    ggtitle(\"NE, S, MW, W: Regional Location for Adults with AMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.65)))\nprint(region)\nggsave(\"draftregion.pdf\")\n\n#geom_polygon - bring in county info - again need to work out rate\n#note fortify - check column headings\ntracts<-readOGR(dsn='region', layer='cb_2014_us_region_20m')\ntracts<-fortify(tracts, region='NAME')\nhead(tracts)\n\n#join overview and tracts\nregionmap<-left_join(overview[2:5,], tracts, by=c(\"Char\"=\"id\"))\nhead(regionmap)\n\n#map by 4 regions - however this is population NOT rate \n#not pursuing this now\nregionmap_plot <-ggplot(regionmap, aes(x=long, y=lat, group=group, fill=Total))+\n  geom_polygon(color='#6E6E6E', size=.5)+\n    coord_map()+\n  scale_fill_gradient(low=\"#FFEFD5\", high=\"#FF6347\")+\n    ggtitle(\"Regional Location for Adults with AMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(1.2)))\nprint(regionmap_plot)\nggsave(\"draftAMI by Region Map.pdf\", width=11, height=6)\n\n#bar chart_urban or rural AMI: not pursuing this and probably need to think about rate here\nurban<-ggplot(overviewtot[11:13,], aes(x=Char, y=Total))+\n  geom_bar(stat=\"identity\", width=.2, fill=\"purple\")+\n  cctheme+\n  xlab(\"Location\")+\n  ylab(\"Percent\")+\n  ggtitle(\"Urban/Rural Location for Adults with AMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.7)))\nprint(urban)\nggsave(\"drafturban.pdf\")\n\n#bar chart_health care insurance type AMI - point of this is that\n#20% don't have coverage, however not pursuing this one right now, insurance coverage changing so quickly \ninsurance<-ggplot(overviewtot[18:21,], aes(x=Char, y=Total))+\n  geom_bar(stat=\"identity\", width=.2, fill=\"blue\")+\n  cctheme+\n  xlab(\"Type of Insurance\")+\n  ylab(\"Percent\")+\n  ggtitle(\"Health Insurance Coverage Type for Adults with AMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.65)))\nprint(insurance)\nggsave(\"draftinsurance.pdf\")\n\n#geom_line total AMI compared to 100% belowFPL\n#significant that if below poverty level higher AMI, and ppt increases with age\nFPL<-ggplot(overviewFPL, aes(x=charact, y=percent, color=charact))+\n  geom_point()+\n  geom_line()+\n  geom_text(aes(label=percent),hjust=0, vjust=0)+\n  scale_y_continuous(lim=c(0, 35))+\n  coord_flip()+\n  xlab(\"Age\")+\n  ylab(\"Percent\")+\n  cctheme+\n  ggtitle(\"Income below the Federal Poverty Level Increases Likelihood of Any Mental Illness (AMI) in Adults, 2014\")+\n    theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.6)), legend.position='none')\n  print(FPL)\nggsave(\"BelowFPLAMI.pdf\", FPL, width =10, height=4, useDingbats=FALSE)\n\n#NOTE - do same for SMI and below FPL line by age\nFPLSMI<-ggplot(overviewSMIFPL3, aes(x=age, y=percent, color=age))+\n  geom_point()+\n  geom_line()+\n  geom_text(aes(label=percent),hjust=0, vjust=0)+\n  scale_y_continuous(lim=c(0, 10))+\n  coord_flip()+\n  cctheme+\n  xlab(\"Age\")+\n  ylab(\"Percent\")+\n  ggtitle(\"Adults Below the Federal Poverty Level with SMI Compared to All Adults with SMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.65)), \n        legend.position='none')\nprint(FPLSMI)\nggsave(\"BelowFPLSMI.pdf\", FPLSMI, width =10, height=4, useDingbats=FALSE)\n\n#CHECK plotting same with geom_bar - another way of showing this\nFPLbar<-ggplot(overviewFPL, aes(x=charact, y=percent, fill=Char, order=Char))+\n  geom_bar(stat=\"identity\", position='dodge', width = .6)+\n    cctheme+\n  scale_fill_brewer()+\n     xlab(\"Population\")+\n      ylab(\"Percent\")+\n  ggtitle(\"Adults Below the Federal Poverty Level with AMI Compared to All Adults with AMI, 2014\")+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.6)))\nprint(FPLbar)\nggsave(\"draftBelowFPLBar.pdf\", width =5, height=6)\n\n#NOTE timeline for AMI 2008-2014 18-25 going up\nyears_ages<-gather(years, Year, Percent, X2008:X2014)\nstr(years_ages)\nhead (years_ages)\n\nyearsAMI<-ggplot(years1, aes(x=Year, y=Percent, group=Age, color=Age))+\n  geom_line(width=2)+\n  geom_point()+\n  #geom_text(aes(label=Percent))+\n      scale_y_continuous(limits=c(0, 22))+\n  ggtitle(\"AMI by Age, 18 and Older, by Years 2008-2014\")+\n    cctheme+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.65)))\nprint(yearsAMI)\nggsave(\"yearsAMI.pdf\", yearsAMI, width =7, height=4, useDingbats=FALSE)\n\n#NOTE SMI 18-25 going up - timeline for SMI 2008-2014\nyearsSMItimeline<-gather(yearsSMI, Year, Percent, X2008:X2014)\nstr(yearsSMI)\nhead (yearsSMItimeline)\n\nyearsSMIage<-ggplot(yearsSMItimeline, aes(x=Year, y=Percent, group=Age, color=Age))+\n  geom_line(width=2)+\n  geom_point()+\n  geom_text(aes(label=Percent))+\n      scale_y_continuous(limits=c(0, 10))+\n  ggtitle(\"SMI by Age, 18 and Older, by Years 2008-2014\")+\n      cctheme+\n      theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.65)))\nprint(yearsSMIage)\nggsave(\"yearsSMIage.pdf\", yearsSMIage, width =7, height=4, useDingbats=FALSE)\n\n#geom_area for all AMI (total 18 and older) for each year \n#so for all AMI the numbers are going down\nyears2<-filter(years_ages, Age=='Total 18 or Older')\nhead(years2)\nyearsAMItot_area<-ggplot(years2, aes(x=Year, y=Percent, group=Age, color=Age))+\n  geom_area(fill=\"#CD8500\", color=\"#CD8500\")+ \n  geom_point()+\n  geom_text(aes(label=Percent))+\n  ggtitle(\"AMI 18 Years and Older, Years 2008-2014\")+\n  cctheme+\n  scale_y_continuous(limits=c(0, 30))+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.7)))\nprint(yearsAMItot_area)\nggsave(\"yearsAMItotalarea.pdf\", years2, width =7, height=4, useDingbats=FALSE)\n\n#geom_area for all SMI (total 18 and older) for each year\n#for all SMI numbers going down from last year\nyearsS<-filter(yearsSMI, Age=='18 or Older')\nhead(yearsS)\n\nyearsSM<-gather(yearsS, Year, Percent, X2008:X2014)\nhead(yearsSM)\n\nyearsSMItot_area<-ggplot(yearsSM, aes(x=Year, y=Percent, group=Age, color=Age))+\n  geom_area(fill=\"#DA0000\", color=\"#DA0000\")+\n  geom_point()+\n  geom_text(aes(label=Percent))+\n  ggtitle(\"SMI 18 Years and Older, Years 2008-2014\")+\n  cctheme+\n  scale_y_continuous(limits=c(0, 25))+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.7)))\nprint(yearsSMItot_area)\nggsave(\"yearsSMItotalarea.pdf\", yearsSMItot_area, width =8, height=5, useDingbats=FALSE)\n\n#get the SUD with AMI and SUD with SMI and do lines for SUD/AMI and SMI\n#gather SUD\nSUDAMISMI1<-gather(SUDAMISMI, Year, Percent, X2008:X2014)\nhead(SUDAMISMI1)\nstr(SUDAMISMI1)\n\n#line plot SUD overlap totals by year\nyearsSUDAMISMIoverlap<-ggplot(SUDAMISMI1, aes(x=Year, y=Percent, \n                                         group=Age, color=Age))+\n  geom_line()+\n  geom_text(aes(label=Percent))+\n  ggtitle(\"SUD Overlap with AMI, and with SUD Overlap with SMI, 18 Years and Older, Years 2008-2014\")+\n  cctheme+\n  scale_y_continuous(limits=c(0, 4.2))+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.6)))\nprint(yearsSUDAMISMIoverlap)\nggsave(\"SUDAMISMIOverlap.pdf\", yearsSUDAMISMIoverlap, width =7, height=4, useDingbats=FALSE)\n\n\n#get the SUD and AMI added to SMI / AMI \n#join SUD and AMIarea with rbind\noverlapAMISUD<-rbind(years2, SUDAMISMI1)\nhead(overlapAMISUD)\n\n#take out SUD and AMI as these are in the other SUD totals\noverlapAMISUD2<-subset(overlapAMISUD[c(1:7,9:10,12:13,15:16,18:19,21:22,24:25,27:28),]) \nhead(overlapAMISUD2)\n\n#geom_area with AMI, plus SUD overlaps with AMI SMI percentages stacked on top\nyearsSUDtot_area<-ggplot(overlapAMISUD2, aes(x=Year, y=Percent, \n                                         group=Age, fill=Age))+\n  geom_area( stat='identity')+\n  geom_text(aes(label=Percent, stat='identity'))+\n  ggtitle(\"SUD Overlap with AMI, and with SUD Overlap with SMI, 18 Years and Older, Years 2008-2014\")+\n  cctheme+\n  scale_y_continuous(limits=c(0,25))+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.6)))\nprint(yearsSUDtot_area)\nggsave(\"overlapareaAMISUD.pdf\", width=8, height =5)\n\n#try and add SMI to the geom_area\nyearsSMItimeline18<-filter(yearsSMItimeline, Age=='18 or Older')\nhead(yearsSMItimeline18)\n\noverlapAMISUDSMI<-rbind(overlapAMISUD, yearsSMItimeline18)\nhead(overlapAMISUDSMI)\n\n#need to check percents - some of these overlap, not stack\nyearsSUDtot_area2<-ggplot(overlapAMISUDSMI, aes(x=Year, y=Percent, \n                                            group=Age, fill=Age))+\n  geom_area( stat='identity')+\n  #geom_text(aes(label=Percent, stat='identity'))+\n  ggtitle(\"SUD Overlap with AMI, and with SUD Overlap with SMI, 18 Years and Older, Years 2008-2014\")+\n  cctheme+\n  scale_y_continuous(limits=c(0,30))+\n  theme(axis.text=element_text(size=rel(1.3)), title=element_text(size=rel(0.6)))\nprint(yearsSUDtot_area2)\nggsave(\"AMI,SMI,SUDs.pdf\", yearsSUDtot_area2, width =10, height=4, useDingbats=FALSE)\n\n\n\n",
    "created" : 1449980392419.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "364085624",
    "id" : "88F6C731",
    "lastKnownWriteTime" : 1449984139,
    "path" : "~/Documents/ccinflux/Documents/Data Vis Info/Homework/Final project/BH/BH/Overview/Overview2.R",
    "project_path" : "Overview2.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : true,
    "type" : "r_source"
}